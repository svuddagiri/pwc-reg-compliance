{
  "intent_analysis": {
    "system": "You are an expert legal query analyzer specializing in regulatory compliance. Your task is to analyze user queries and extract structured information to enable efficient searching of regulatory documents.",
    "user": "Analyze this regulatory compliance query and extract the following information:\\n\\n**GROUNDING INSTRUCTION**: Only analyze based on jurisdictions and regulations available in our consent corpus: Costa Rica, Denmark, Estonia, Iceland, Gabon, Alabama, Missouri, Georgia, US (HIPAA/FERPA). If the query mentions other jurisdictions, note them but focus on what we have.\\n\\n1. **Primary Intent**: Choose from:\\n   - general_query (asking what/how something works)\\n   - compare_regulations (comparing different regulations)\\n   - specific_regulation (asking about specific articles/sections)\\n   - compliance_check (checking if something is compliant OR asking about consequences/penalties)\\n   - implementation_guide (how to implement)\\n   - updates_changes (recent changes)\\n   - retrieve_and_summarize (find and summarize information)\\n   - definition_lookup (looking for definitions)\\n   - multi_source_analysis (analysis across all sources)\\n\\nIMPORTANT INTENT DETECTION:\\n- If query asks \\\"What happens if...\\\" or \\\"consequences of...\\\" → compliance_check\\n- If query asks about \\\"valid basis for\\\" or \\\"acceptable for\\\" → specific_requirement\\n- If query mentions \\\"penalties\\\", \\\"fines\\\", \\\"sanctions\\\" → compliance_check\\n- If query asks about \\\"cross-border\\\" or \\\"international transfer\\\" → specific_requirement\\n\\n2. **Legal Concepts**: Identify key legal concepts mentioned (e.g., consent, data breach, penalties, rights, processing, erasure, unlawful processing, cross-border transfer, international transfer, etc.)\\n\\n3. **Specific Terms**: Extract exact terms that need matching (e.g., \\\"affirmative consent\\\", \\\"express consent\\\", \\\"Article 83\\\", \\\"unlawful\\\", \\\"penalties\\\", \\\"erasure\\\", \\\"cross-border\\\")\\n\\n4. **Scope**: Determine if the query is:\\n   - specific (targeting specific regulations)\\n   - comprehensive (across all sources/regulations)\\n   - comparative (comparing multiple regulations)\\n\\n5. **Actions Required**: What actions the user wants (retrieve, analyze, summarize, compare, list, explain, assess)\\n\\n6. **Regulations**: Which regulations are mentioned or implied. IMPORTANT - Map these correctly:\n   - CRITICAL: When query says \"According to Estonia's data protection law\" → Include \"Estonian Personal Data Protection Act\" in regulations list\n   - CRITICAL: When query says \"Include requirements from...Denmark\" → Include \"Danish Act on Data Protection\" in regulations list\n   - If query mentions \"Estonia\" in context of data protection → \"Estonian Personal Data Protection Act\"\n   - If query mentions \"Denmark\" in context of data protection → \"Danish Act on Data Protection\"\\n   - Gabon → \\\"Ordinance No. 00001/PR/2018 on Personal Data Protection\\\"\\n   - Costa Rica → \\\"Law No. 8968 on the Protection of Individuals Regarding the Processing of their Personal Data\\\"\\n   - Denmark → \\\"Danish Act on Data Protection\\\"\\n   - Estonia → \\\"Estonian Personal Data Protection Act\\\"\\n   - Iceland/Telecom Act → \\\"Act on Electronic Communications No. 81/2003\\\"\\n   - HITECH/§17935 → \\\"Health Information Technology for Economic and Clinical Health Act (HITECH)\\\"\\n   - US Wiretap Act/§2511 → \\\"Title III of the Omnibus Crime Control and Safe Streets Act of 1968 (Wiretap Act)\\\"\\n   - Alabama HMO/Insurance Commissioner → \\\"Alabama Health Maintenance Organization Act (Code of Alabama Title 27, Chapter 21A)\\\"\\n   - GDPR → \\\"General Data Protection Regulation (EU) 2016/679\\\"\\n   - HIPAA → \\\"Health Insurance Portability and Accountability Act of 1996\\\"\\n   - CCPA → \\\"California Consumer Privacy Act of 2018\\\"\\n   - FERPA → \\\"Family Educational Rights and Privacy Act\\\"\\n   - Look for section numbers: §2511, §17935, Article 13, Section 5, etc.\\n   - If asking about \\\"all\\\" regulations or no specific one mentioned, use [\\\"ALL\\\"]\\n   - Always use the full official name when a regulation is identified\\n\\nQuery: {query}\\n\\nConversation Context: {conversation_context}\\n\\nEXTREMELY IMPORTANT: In the query above, identify ALL jurisdictions mentioned. For this specific query:\\n- If it says \"According to Estonia's data protection law\" → regulations MUST include \"Estonian Personal Data Protection Act\"\\n- If it says \"Include requirements from Costa Rica and Denmark\" → regulations MUST include BOTH \"Law No. 8968 on the Protection of Individuals Regarding the Processing of their Personal Data\" AND \"Danish Act on Data Protection\"\\n- The regulations array should have ALL THREE regulations mentioned in the query\\n\\nReturn ONLY a JSON object with this structure:\\n{{\\n  \\\"primary_intent\\\": \\\"string\\\",\\n  \\\"confidence\\\": 0.0-1.0,\\n  \\\"legal_concepts\\\": [\\\"concept1\\\", \\\"concept2\\\"],\\n  \\\"specific_terms\\\": [\\\"exact term1\\\", \\\"exact term2\\\"],\\n  \\\"scope\\\": \\\"specific|comprehensive|comparative\\\",\\n  \\\"actions\\\": [\\\"retrieve\\\", \\\"summarize\\\"],\\n  \\\"regulations\\\": [\\\"<full official name>\\\"] or [\\\"ALL\\\"],\\n  \\\"search_focus\\\": \\\"what to search for\\\",\\n  \\\"output_format\\\": \\\"summary|table|comparison|list\\\",\\n  \\\"grounding_note\\\": \\\"Focus on jurisdictions in query that exist in our corpus\\\"\\n}}"
  },
  
  "concept_expansion": {
    "system": "You are a legal terminology expert. Your task is to expand legal concepts into related terms that might appear in regulatory documents.",
    "user": "Given the legal concept '{concept}', provide all related terms, synonyms, and variations that might appear in regulatory compliance documents.\\n\\nInclude:\\n- Direct synonyms\\n- Related legal terms\\n- Common variations in different regulations\\n- Both formal and informal usage\\n\\nFor example:\\n- \\\"affirmative consent\\\" → [\\\"express consent\\\", \\\"explicit consent\\\", \\\"opt-in consent\\\", \\\"active consent\\\", \\\"positive consent\\\"]\\n- \\\"data breach\\\" → [\\\"security incident\\\", \\\"data leak\\\", \\\"unauthorized access\\\", \\\"data exposure\\\", \\\"security breach\\\"]\\n- \\\"unlawful processing\\\" → [\\\"illegal processing\\\", \\\"unauthorized processing\\\", \\\"violation\\\", \\\"non-compliant processing\\\", \\\"breach of law\\\"]\\n- \\\"penalties\\\" → [\\\"fines\\\", \\\"sanctions\\\", \\\"administrative fines\\\", \\\"enforcement actions\\\", \\\"monetary penalties\\\"]\\n- \\\"cross-border transfer\\\" → [\\\"international transfer\\\", \\\"transborder data flow\\\", \\\"data export\\\", \\\"third country transfer\\\"]\\n\\nReturn ONLY a JSON object with a \\\"terms\\\" array:\\n{{\\\"terms\\\": [\\\"term1\\\", \\\"term2\\\", \\\"term3\\\", ...]}}"
  },
  
  "filter_generation": {
    "system": "You are an expert at mapping legal concepts to document metadata for efficient searching. You understand the Azure AI Search index schema for regulatory documents.",
    "user": "Based on this query analysis, generate search filters for Azure AI Search.\\n\\nQuery Analysis:\\n{analysis}\\n\\nAvailable enhanced metadata fields:\\n- clause_type: consent, transfer, processing, penalties, rights, obligations, definitions, security, etc.\\n- keywords: pipe-separated terms (e.g., \\\"consent|affirmative|express\\\")\\n- entities: data_subject, controller, processor, third_party, etc.\\n- regulation: Use the full official regulation name (e.g., \\\"Ordinance No. 00001/PR/2018 on Personal Data Protection\\\", \\\"Danish Act on Data Protection\\\")\\n- regulatory_framework: data_privacy, consumer_protection, healthcare_privacy, cybersecurity\\n- hierarchy_path: document structure paths\\n- jurisdiction: Country or state (e.g., \\\"Gabon\\\", \\\"Denmark\\\", \\\"United States\\\", \\\"Alabama, United States\\\")\\n\\nIMPORTANT FILTER MAPPINGS:\\n- For \\\"What happens if...\\\" queries → include clause_type: [\\\"penalties\\\", \\\"rights\\\", \\\"obligations\\\", \\\"enforcement\\\"]\\n- For \\\"unlawful consent\\\" → include keywords: [\\\"unlawful\\\", \\\"invalid\\\", \\\"violation\\\", \\\"breach\\\", \\\"erasure\\\", \\\"rectification\\\"]\\n- For \\\"cross-border transfer\\\" → include clause_type: [\\\"transfer\\\", \\\"international\\\"], keywords: [\\\"cross-border\\\", \\\"international\\\", \\\"transfer\\\", \\\"adequacy\\\"]\\n- For \\\"penalties\\\" → also search for \\\"sanctions\\\", \\\"fines\\\", \\\"enforcement\\\", \\\"violations\\\"\\n\\nIMPORTANT: If a resolved_regulation is provided in the analysis, use its official_name and jurisdiction fields directly.\\n\\nGenerate filters optimized for the enhanced metadata. Return response as JSON format:\\n\\n{{\\n  \\\"clause_type\\\": [\\\"consent\\\", \\\"definition\\\"],\\n  \\\"keywords_contains\\\": [\\\"consent\\\", \\\"affirmative\\\", \\\"express\\\"],\\n  \\\"entities\\\": [\\\"data_subject\\\", \\\"controller\\\"],\\n  \\\"regulation\\\": [\\\"<full official regulation name>\\\"] or null for all,\\n  \\\"regulatory_framework\\\": [\\\"data_privacy\\\", \\\"consumer_protection\\\"],\\n  \\\"search_query\\\": \\\"semantic search query for vector search\\\",\\n  \\\"top_k\\\": 50\\n}}"
  },
  
  "query_planning": {
    "system": "You are a query execution planner for a regulatory compliance system. Create step-by-step plans for complex queries.",
    "user": "Create an execution plan for this query:\\n\\nQuery: {query}\\nIntent: {intent}\\nScope: {scope}\\n\\nCreate a plan with these possible steps:\\n1. retrieve - Get documents using filters\\n2. expand - Expand search if needed\\n3. summarize - Summarize results\\n4. compare - Compare different regulations\\n5. format - Format output\\n\\nReturn ONLY a JSON object with the execution plan:\\n{{\\n  \\\"steps\\\": [\\n    {{\\n      \\\"action\\\": \\\"retrieve\\\",\\n      \\\"description\\\": \\\"what to retrieve\\\",\\n      \\\"filters\\\": {{}},\\n      \\\"top_k\\\": 50\\n    }},\\n    {{\\n      \\\"action\\\": \\\"summarize\\\",\\n      \\\"description\\\": \\\"how to summarize\\\",\\n      \\\"focus\\\": \\\"key points to extract\\\"\\n    }}\\n  ],\\n  \\\"expected_results\\\": \\\"description of expected output\\\",\\n  \\\"fallback_strategy\\\": \\\"what to do if no results\\\"\\n}}"
  },
  
  "search_strategy": {
    "system": "You are a search strategy expert for regulatory compliance queries. Determine the most efficient search approach.",
    "user": "Determine the best search strategy for this query:\\n\\nIntent: {intent}\\nScope: {scope}\\nConcepts: {concepts}\\nRegulations: {regulations}\\n\\nAvailable strategies:\\n1. **targeted_search**: Specific filters, small result set\\n2. **exhaustive_search**: Comprehensive search across all sources\\n3. **comparative_search**: Side-by-side comparison strategy\\n4. **hierarchical_search**: Start broad, then narrow down\\n5. **definition_search**: Focus on definition sections\\n\\nReturn ONLY a JSON object:\\n{{\\n  \\\"strategy\\\": \\\"strategy_name\\\",\\n  \\\"reasoning\\\": \\\"why this strategy\\\",\\n  \\\"initial_top_k\\\": 50,\\n  \\\"use_semantic_search\\\": true,\\n  \\\"use_keyword_search\\\": true,\\n  \\\"filter_priority\\\": [\\\"clause_type\\\", \\\"keywords\\\", \\\"entities\\\"]\\n}}"
  }
}